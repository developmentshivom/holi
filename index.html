// Complete WebRTC Video App with Canvas Overlay for Coloring Each Other

// HTML structure (Add this to index.html)
const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Color App</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script src="script.js" defer></script>
    <style>
        body { margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; background: black; }
        video { position: absolute; width: 100%; height: 100%; object-fit: cover; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    </style>
</head>
<body>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
</body>
</html>`;

// JavaScript file (script.js)
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const video = document.getElementById('video');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Firebase setup (Replace with your Firebase config)
const firebaseConfig = {
  apiKey: "AIzaSyD9geqCCQlvh725M5aV22hYWUNa2YU6qYM",
  authDomain: "virtual-holi-game.firebaseapp.com",
  databaseURL: "https://virtual-holi-game-default-rtdb.firebaseio.com",
  projectId: "virtual-holi-game",
  storageBucket: "virtual-holi-game.firebasestorage.app",
  messagingSenderId: "348578981043",
  appId: "1:348578981043:web:78126b6e1605efab6afcc6",
  measurementId: "G-9B3T81ZSR8"
};
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

// Get webcam feed
navigator.mediaDevices.getUserMedia({ video: true, audio: false })
    .then((stream) => { video.srcObject = stream; })
    .catch((error) => console.error('Error accessing webcam:', error));

// Handle click to draw
canvas.addEventListener('click', (e) => {
    const x = e.clientX / canvas.width;
    const y = e.clientY / canvas.height;
    const color = '#' + Math.floor(Math.random()*16777215).toString(16); // Random color
    
    // Send drawing data to Firebase
    db.ref('drawings').push({ x, y, color });
});

// Draw received data
const drawOnCanvas = (x, y, color) => {
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(x * canvas.width, y * canvas.height, 10, 0, 2 * Math.PI);
    ctx.fill();
};

db.ref('drawings').on('child_added', (snapshot) => {
    const { x, y, color } = snapshot.val();
    drawOnCanvas(x, y, color);
});

// Firebase Database Setup Steps:
// 1. Go to https://console.firebase.google.com/ and create a new project.
// 2. Enable Realtime Database: Go to Build > Realtime Database > Create Database.
// 3. Set rules to allow read/write access for testing:
//    {
//      "rules": {
//        ".read": true,
//        ".write": true
//      }
//    }
// 4. Copy your Firebase config and replace in script.js.
// 5. Deploy the project using GitHub and Vercel.
